/* styles.css (updated) */

/* --------- Global baseline (reusable across charts) --------- */

:root {
  /* Typography */
  --font-sans: "Barlow", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

  /* Color palette (light theme by default) */
  --bg: #ffffff;
  --text: #1f2937;         /* slate-800 */
  --muted: #6b7280;        /* slate-500 */
  --line: #e5e7eb;         /* gray-200 */
  --panel: #f8fafc;        /* slate-50 */

  /* Accents (your prefs) */
  --accent: #f67cf6;       /* inspiration pink */
  --accent-2: #0dd6c7;     /* teal */
  --warn: #ffa500;
  --ok: #46c134;

  /* Chart helpers */
  --node-stroke: #333;
  --link: #9aa3af;         /* gray-400 */
  --tooltip-bg: #fff;
  --tooltip-border: #e5e7eb;

  /* Sizing & rhythm */
  --maxw: 960px;
  --gutter: 16px;
  --radius: 12px;
  --shadow: 0 1px 3px rgba(0,0,0,.08), 0 1px 2px rgba(0,0,0,.06);

  color-scheme: light;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0f1115;
    --text: #e5e7eb;
    --muted: #94a3b8;
    --line: #1f2937;
    --panel: #161a22;
    --link: #64748b;
    --tooltip-bg: #111827;
    --tooltip-border: #1f2937;
    color-scheme: dark;
  }
}

/* Reset-ish */
*,
*::before,
*::after { box-sizing: border-box; }

html, body {
  /* CHANGED: min-height avoids capping the document in iframes */
  min-height: 100%;
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-sans);
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* Root app container: no forced centering/padding */
#app {
  margin: 0 auto;
  max-width: var(--maxw);
  padding: 0 var(--gutter);
}

/* Headings */
h1, h2, h3 {
  margin: 0 0 0.5em;
  line-height: 1.2;
  font-weight: 600;
}
h1 { font-size: clamp(1.6rem, 2vw + 1rem, 2.2rem); }
h2 { font-size: clamp(1.3rem, 1.2vw + 1rem, 1.6rem); }
h3 { font-size: 1.125rem; }

/* Text */
p { margin: 0 0 0.8em; color: var(--text); }
small, .muted { color: var(--muted); }

/* Links */
a { color: var(--accent-2); text-decoration: none; }
a:hover { text-decoration: underline; }

/* Buttons */
.button {
  appearance: none;
  border: 1px solid var(--line);
  background: var(--panel);
  color: var(--text);
  border-radius: 10px;
  padding: 0.55rem 0.9rem;
  font: 500 0.95rem/1 var(--font-sans);
  cursor: pointer;
  transition: background .2s, border-color .2s;
}
.button:hover { border-color: var(--accent); }
.button.primary {
  background: var(--accent);
  border-color: var(--accent);
  color: #000;
}
.button.ghost { background: transparent; }

/* Reusable layout helpers */
.container {
  max-width: var(--maxw);
  margin-inline: auto;
  padding-inline: var(--gutter);
}
.stack > * + * { margin-top: 1rem; }
.grid { display: grid; gap: 1rem; }
@media (min-width: 800px) { .grid.cols-2 { grid-template-columns: 1fr 1fr; } }

/* Card/panel */
.panel {
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 0.8rem;
}

/* Chart wrapper (use this around each viz) */
.chart-wrap {
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 0.75rem;
  overflow: hidden;
}

/* Caption & footnotes */
.caption {
  margin-top: 0.5rem;
  font-size: 0.9rem;
  color: var(--muted);
}
.kicker {
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.03em;
  color: var(--muted);
}

/* Legend (generic horizontal) */
.legend {
  display: flex;
  flex-wrap: wrap;
  gap: 8px 14px;
  align-items: center;
  font-size: 0.9rem;
}
.legend .swatch {
  width: 14px; height: 14px;
  border-radius: 3px;
  border: 1px solid var(--line);
  margin-right: 6px;
}

/* Tooltip — generic reusable */
.tooltip {
  position: absolute;
  z-index: 10;
  pointer-events: none;
  background: var(--tooltip-bg);
  border: 1px solid var(--tooltip-border);
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 12px;
  color: var(--text);
  box-shadow: var(--shadow);
}

/* SVG defaults for charts */
svg.chart {
  display: block;
  width: 100%;
  height: auto;
}

/* D3 network graph defaults */
.nodes circle { stroke: var(--node-stroke); stroke-width: 1.2px; }
.nodes circle:hover { stroke: #666; stroke-width: 3px; }
.links line { stroke: var(--link); stroke-opacity: 0.6; }
.n-label { font-size: 12px; fill: var(--text); }

/* Mobile tuning */
@media (max-width: 640px) {
  .container, #app { padding-inline: 12px; }
  .chart-wrap { padding: 0.6rem; }
  .caption { font-size: 0.85rem; }
}

/* Motion accessibility */
@media (prefers-reduced-motion: reduce) {
  * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
}

/* ============================================================
   Network chart namespace (fixed bottom info panel + svg styles)
   ============================================================ */

/* Default lift for the floating panel; JS updates this var dynamically */
.network-chart { --panel-overlap: 64px; }
@media (max-width: 640px) { .network-chart { --panel-overlap: 72px; } }

/* Prevent clipping anywhere in the chain and add a tiny buffer */
.network-chart,
.network-chart .chart,
.network-chart .net-svg { overflow: visible !important; }
.network-chart .chart { margin-bottom: 12px; }

/* Chart wrapper (parent-width, no vw) */
.network-chart .chart {
  max-width: 900px;    /* desktop cap */
  width: 100%;         /* track parent/iframe width */
  margin: 16px auto 0;
  padding-bottom: var(--panel-overlap); /* reserved space for info panel */
  position: relative;  /* anchor for the info panel */
  font-family: var(--font-sans);
}

/* Mobile cap: 300px wide on small screens */
@media (max-width: 640px) {
  .network-chart .chart { max-width: 300px; }
}

/* The SVG used by your network */
.network-chart .net-svg {
  display: block;
  width: 100%;
  height: auto;
  background: #fafafa;
  border: 1px solid var(--line);
  border-radius: 8px;
}

/* Smooth link highlight */
.network-chart .links line {
  transition: stroke 120ms ease, stroke-width 120ms ease, stroke-opacity 120ms ease;
}

/* Centered info panel, lifted into the gray SVG area */
.network-chart .info-panel {
  position: absolute;
  left: 50%;
  bottom: 12px; /* distance from container bottom */
  transform: translateX(-50%) translateY(calc(-1 * var(--panel-overlap)));
  z-index: 10;
  pointer-events: none; /* chart remains interactive */
}

@media (max-width: 640px) {
  .network-chart .info-panel {
    width: calc(100% - 20px); /* 10px gutter on each side */
    left: 50%;
    transform: translateX(-50%) translateY(calc(-1 * var(--panel-overlap)));
  }

  .network-chart .info-content {
    display: block;     /* not inline-block on mobile */
    width: 100%;
    max-width: none;    /* let it be as wide as the panel */
  }
}

.network-chart .info-content {
  display: inline-block;
  background: #fff;
  border: 1px solid var(--line);
  border-radius: 8px;
  box-shadow: 0 2px 12px rgba(0,0,0,.12);
  padding: 10px 12px;
  font-size: 14px;
  line-height: 1.35;
  color: var(--text);
  pointer-events: auto;  /* if you add links/buttons inside */
  max-width: clamp(360px, 90vw, 640px);
}

/* Dark-mode tweaks for panel */
@media (prefers-color-scheme: dark) {
  .network-chart .info-content {
    background: var(--tooltip-bg);
    border-color: var(--tooltip-border);
    box-shadow: 0 2px 12px rgba(0,0,0,.4);
  }
}

/* Spacer that guarantees the doc height includes the floating panel (used in markup) */
.network-chart .pym-sizer { height: calc(var(--panel-overlap) + 12px); }

/* ============================================================
   Network controls (desktop buttons in gray box; mobile dropdown)
   ============================================================ */

.network-chart .controls {
  position: absolute;
  top: 10px;
  left: 10px;
  right: 10px;
  z-index: 20;
  pointer-events: auto;

  display: flex;
  align-items: center;
  justify-content: flex-start;

  /* A subtle pill-bar backdrop so buttons read well on the gray SVG */
  background: rgba(248, 250, 252, 0.85);
  border: 1px solid var(--line);
  border-radius: 10px;
  padding: 6px;
  backdrop-filter: blur(6px);
}

@media (prefers-color-scheme: dark) {
  .network-chart .controls {
    background: rgba(22, 26, 34, 0.75);
  }
}

/* Desktop buttons */
.network-chart .controls-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

/* Make the pill buttons slightly tighter */
.network-chart .controls-buttons .button {
  padding: 0.45rem 0.7rem;
  border-radius: 999px;
  font-size: 0.92rem;
}

/* ✅ SHOW/HIDE: desktop pills vs mobile dropdown */
.network-chart .controls-select { display: none; }

/* Control checkbox highlight color */
.network-chart .filter-item input[type="checkbox"] {
  accent-color: var(--accent-2); /* teal, matches your buttons */
}


@media (max-width: 640px) {
  .network-chart .controls-buttons { display: none; }
  .network-chart .controls-select { display: block; width: 100%; }
  .network-chart .controls-select .button { width: 100%; text-align: left; }
}

/* ✅ Dropdown panel styling */
.network-chart .filter-pop {
  margin-top: 8px;
  background: rgba(255,255,255,0.97);
  border: 1px solid var(--line);
  border-radius: 12px;
  box-shadow: var(--shadow);
  padding: 10px;

  max-height: 45vh;
  overflow: auto;
}

@media (prefers-color-scheme: dark) {
  .network-chart .filter-pop {
    background: rgba(22, 26, 34, 0.92);
  }
}

.network-chart .filter-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 6px 2px;
  font-size: 0.95rem;
}

.network-chart .filter-item input {
  width: 18px;
  height: 18px;
}

/* Screen-reader only helper */
.sr-only {
  position: absolute !important;
  width: 1px; height: 1px;
  padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0,0,0,0);
  white-space: nowrap; border: 0;
}

/* ============================================================
   Hover focus (existing)
   ============================================================ */

/* Focus + context (grey out everything except hovered node + its neighborhood) */
.network-chart .nodes circle.is-dim {
  opacity: 0.15;
  filter: grayscale(1);
}

.network-chart .links line.is-dim {
  stroke-opacity: 0.08;
}

.network-chart .nodes circle.is-hi {
  opacity: 1;
  filter: none;
  stroke: #666;
  stroke-width: 3px;
}

.network-chart .links line.is-hi {
  stroke-opacity: 0.95;
  stroke: #666;
  stroke-width: 3px;
}

/* ============================================================
   Category selection dimming (NEW)
   ============================================================ */

.network-chart .nodes circle.is-cat-dim {
  opacity: 0.12;
}

.network-chart .links line.is-cat-dim {
  stroke-opacity: 0.08;
}

.network-chart .nodes circle.is-cat-hi {
  opacity: 1;
}

.network-chart .links line.is-cat-hi {
  stroke-opacity: 0.55;
}

/* Hover focus should override category dim visually */
.network-chart .nodes circle.is-hi {
  opacity: 1 !important;
}
.network-chart .links line.is-hi {
  stroke-opacity: 0.95 !important;
}

.network-chart .nodes circle.is-dim {
  opacity: 0.08 !important;
}
.network-chart .links line.is-dim {
  stroke-opacity: 0.05 !important;
}
